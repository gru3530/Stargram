name: CI Pipeline

on:
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3

      - name: JDK ì„¤ì •
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Gradle ìºì‹œ ì„¤ì •
        uses: actions/cache@v3
        with:
          path: ~/.gradle/caches
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle

      - name: Gradle Wrapper ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
        run: chmod +x ./gradlew

      - name: ì¢…ì†ì„± ì„¤ì¹˜
        run: ./gradlew build -x test

      - name: í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        run: ./gradlew test asciidoctor --info --warning-mode all

      - name: íŒŒì¼ í™•ì¸
        run: |
          echo "ğŸ“‚ build/docs/html ë””ë ‰í† ë¦¬ ìƒíƒœ:"
          ls -R build/docs/html
          echo "ğŸ“‚ src/docs ë””ë ‰í† ë¦¬ ìƒíƒœ:"
          ls -R src/docs


      - name: ë¬¸ì„œ ë°°í¬ ì¤€ë¹„
        run: |
          mkdir -p docs
          cp build/docs/html/index.html docs/
          cp -r src/docs/* docs/

      - name: Stargram API ë¬¸ì„œ GitHub Pages ë°°í¬
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          publish_branch: gh-pages